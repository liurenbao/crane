---
# Kubernetes
## ********************************************************************************************************************************
# Check kubernetes image
- name: Check kubernetes image
  shell: 'for i in k8s.gcr.io/kube-proxy k8s.gcr.io/kube-apiserver-amd64 k8s.gcr.io/kube-controller-manager k8s.gcr.io/kube-scheduler haproxy calico/node calico/cni calico/kube-controllers coredns/coredns k8s.gcr.io/etcd k8s.gcr.io/pause slzcc/keepalived; do if [ ! `docker images --filter=reference="$i*" -aq | wc -l` -ge 1 ] ;then exit 1 ; fi ; done'
  register: result
  ignore_errors: true

- name: Copy Kubernetes Image
  copy:
    src: kubernetes.tar.gz
    dest: "{{ temporary_dirs }}kubernetes.tar.gz"
    owner: "{{ ssh_connect_user }}"
    mode: 0755
  when: result.stderr

- name: Import Kubernetes Docker Image  
  shell: "docker load -i {{ temporary_dirs }}kubernetes.tar.gz"
  when: result.stderr

- name: Image Deploy
  include: roles/downloads-packages/includes/image_deploy.yml
  when: result.stderr
---
# Kubernetes
## ********************************************************************************************************************************
- shell: "ls {{ temporary_dirs }}kubernetes/node/bin"
  register: CHECK_KUBE_BIN_PACKAGE
  ignore_errors: true

- name: Download Kubernetes Ctl And Kubelet Binary Files
  shell: "wget -qO- 'https://dl.k8s.io/{{ k8s_version }}/kubernetes-node-linux-amd64.tar.gz' | tar zx -C {{ temporary_dirs }}"
  changed_when: true
  when: CHECK_KUBE_BIN_PACKAGE | failed

- shell: "cp -rf {{ temporary_dirs }}kubernetes/node/bin/kubectl {{ kubernetes_ctl_path }}"

- shell: "cp -rf {{ temporary_dirs }}kubernetes/node/bin/kubelet {{ kubernetes_ctl_path }}"

- shell: "ls {{ kubernetes_cni_dirs }}"
  register: CHECK_CNI_BIN_PACKAGE
  ignore_errors: true

- name: Download Kubernetes-cni Plugin Binary Files
  shell: "mkdir -p {{ kubernetes_cni_dirs }} && chown -R {{ ssh_connect_user }}.{{ ssh_connect_user }} {{ kubernetes_cni_dirs }}"
  when: CHECK_CNI_BIN_PACKAGE | failed

- shell: "wget -qO- 'https://github.com/containernetworking/plugins/releases/download/{{ cni_version }}/cni-plugins-amd64-{{ cni_version }}.tgz' | tar -zx -C {{ kubernetes_cni_dirs }}"
  when: CHECK_CNI_BIN_PACKAGE | failed
  
# CFSSL
## ********************************************************************************************************************************
- name: Download CFSSL Binary Files *
  shell: "curl -s -o {{ kubernetes_ctl_path }}cfssl https://pkg.cfssl.org/R1.2/cfssl_linux-amd64"
  when: is_kube_master or is_add_master or is_etcd_master

- name: Download CFSSL Binary Files **
  shell: "curl -s -o {{ kubernetes_ctl_path }}cfssljson https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64"
  when: is_kube_master or is_add_master or is_etcd_master

- name: Download CFSSL Binary Files ***
  shell: "chmod +x {{ kubernetes_ctl_path }}cfssl*"
  when: is_kube_master or is_add_master or is_etcd_master

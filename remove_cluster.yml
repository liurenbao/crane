---
- hosts: localhost
  gather_facts: false
  tasks:
    - name: Output current Ansible Version.
      shell: ansible --version || true

- name: Clean Kubernetes Cluster
  hosts: all
  sudo: yes
  remote_user: "{{ ssh_connect_user }}"
  vars:
    ansible_ssh_pipelining: true
  roles:
    - { role: clean-install, tags: [clean]}
  tasks:
    - name: Clean ipvs Record
      shell: "ipvsadm --clear | true"
      when: kube_proxy_mode == "ipvs"
etcd_cluster_type: 'new'

## Deploy Etcd Cluster Host list
## ********************************************************************************************************************************
k8s_master_ip_list: >-
  [{% for host in groups['kube-master'] -%}
    '{{ host }}'
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}]

etcd_master_ip_str: >-
  {% for host in groups['etcd'] -%}
    {{ host }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}

etcd_initial_cluster_addr: >-
  {% for host in groups['etcd'] -%}
    {{ etcd_peer_url_scheme }}://
    {%- if etcd_interface != "" -%}
      {{ hostvars[host]['ansible_' + etcd_interface].ipv4.address }}
    {%- else -%}
      {{ hostvars[host].ansible_default_ipv4.address }}
    {%- endif -%}
  :{{ etcd_client_port }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}

etcd_master_default_ip_str: >-
  {% for host in groups['etcd'] -%}
    {{ hostvars[host].ansible_default_ipv4.address }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}

etcd_master_one_host: "{{ groups['etcd'][0] }}"

etcd_add_node_ip_str: >-
  {% for host in groups['etcd-cluster-add-node'] -%}
    {{ hostvars[host].ansible_default_ipv4.address }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}
  
etcd_add_node_ip_list: >-
  [{% for host in groups['etcd-cluster-add-node'] -%}
    '{{ hostvars[host].ansible_default_ipv4.address }}'
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}]

etcd_cluster_str: >-
  {% for host in groups['etcd'] -%}
    {{ etcd_peer_url_scheme }}://
    {%- if etcd_interface != "" -%}
      {{ hostvars[host]['ansible_' + etcd_interface].ipv4.address }}
    {%- else -%}
      {{ hostvars[host].ansible_default_ipv4.address }}
    {%- endif -%}
  :{{ etcd_client_port }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}

etcd_master_ip_list: >-
  [{% for host in groups['etcd'] -%}
    '{{ host }}'
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}]

etcd_del_node_ip_list: >-
  [{% for host in groups['etcd-cluster-del-node'] -%}
    '{{ hostvars[host].ansible_default_ipv4.address }}'
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}]

etcd_new_cluster_ip_str: >-
  {% for host in groups['etcd-new-cluster'] -%}
    {{ hostvars[host].ansible_default_ipv4.address }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}
  
etcd_new_cluster_ip_list: >-
  [{% for host in groups['etcd-new-cluster'] -%}
    '{{ hostvars[host].ansible_default_ipv4.address }}'
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}]

etcd_new_cluster_scheme_addr: >-
  {% macro initial_cluster() -%}
  {% for host in groups['etcd-new-cluster'] -%}
    {{ hostvars[host]['ansible_nodename'] }}={{ etcd_peer_url_scheme }}://
    {%- if etcd_interface != "" -%}
      {{ hostvars[host]['ansible_' + etcd_interface].ipv4.address }}
    {%- else -%}
      {{ hostvars[host].ansible_default_ipv4.address }}
    {%- endif -%}
  :{{ etcd_peer_port }}
    {%- if not loop.last -%},{%- endif -%}
  {%- endfor -%}
  {% endmacro -%}